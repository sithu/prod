(function(e){e.fn.fieldChooser=function(t){function n(e){var t=e.offset();return{left:t.left,right:t.left+e.width(),top:t.top,bottom:t.top+e.height()}}function r(e,t){return{left:t.left,right:e.right+t.left-e.left,top:t.top,bottom:e.bottom+t.top-e.top}}function i(e,t,i){var s=n(e);var o=n(t);o=r(o,i);var u=true;if(o.right<s.left){u=false}else if(o.left>s.right){u=false}else if(o.bottom<s.top){u=false}else if(o.top>s.bottom){u=false}return u}function u(e,t){if(o){if(o==t){}else{var n=s.getSourceList();if(t==s.getSourceList()){n=s.getDestinationList()}n.clearSelection()}}o=t}if(this.getOptions){return this}var s=this;var o=null;var a=function(t,n){var r=e("<div class='fc-field-list' tabIndex='"+n+"'></div>");r.appendTo(t);var i=-1;var o=-1;r.selectAt=function(e){this.clearSelection();var t=r.getFields();if(e>=t.length){e=t.length-1}var n=null;if(e>=0){n=t.eq(e)}if(n){n.addClass("fc-selected");i=e}else{i=-1}r.trigger("selectionChanged",[r])};r.extendSelection=function(e){var t=this.getSelectedIndex();var n=this.getExtendedSelectionIndex();var s=n;var u=true;if(e){if(s<0){s=r.getFields().length;i=s-1}if(n>t){u=false}else{s--}}else{if(s<0){i=0}if(n<t){u=false}else{s++}}var a=r.getFields();if(s<0||s>=a.length){}else{var f=a.eq(s);if(u){f.addClass("fc-selected")}else{f.removeClass("fc-selected");if(e){s--}else{s++}}r.trigger("selectionChanged",[r]);o=s}};r.selectField=function(e){this.clearSelection();e.addClass("fc-selected");i=e.index();r.trigger("selectionChanged",[r])};r.toggleFieldSelection=function(e){e.toggleClass("fc-selected");if(e.hasClass("fc-selected")){i=e.index();o=-1}else{if(i==e.index()){i=r.children(".fc-selected").first().index()}}r.trigger("selectionChanged",[r])};r.selectTo=function(e){var t=e;if(typeof e=="object"){t=e.index()}if(i==-1){i=0}var n=r.children();if(t>i){for(var s=i;s<n.length;s++){if(s<=t){n.eq(s).addClass("fc-selected");o=s}else{n.eq(s).removeClass("fc-selected")}}}else{for(var s=i;s>=0;s--){if(s>=t){n.eq(s).addClass("fc-selected");o=s}else{n.eq(s).removeClass("fc_selected")}}}r.trigger("selectionChanged",[r])};r.getSelectedIndex=function(){return i};r.getExtendedSelectionIndex=function(){var e=o;if(e<0){e=i}return e};r.getSelection=function(){return this.children(".fc-selected")};r.clearSelection=function(){i=-1;o=-1;this.children().removeClass("fc-selected");r.trigger("selectionChanged",[r])};r.add=function(t){t.addClass("fc-field");t.attr("tabIndex",n);t.on("click",function(t){var n=e(this);if(t.ctrlKey||t.metaKey){s.getFieldList(n).toggleFieldSelection(n)}else if(t.shiftKey){s.getFieldList(n).selectTo(n)}else{s.getFieldList(n).selectField(n)}p=r});t.appendTo(r);return r};r.getFields=function(){return r.children()};r.sortable({connectWith:".fc-field-list",cursor:"move",opacity:.75,helper:function(t,n){if(n.hasClass("fc-selected")){}else{r.selectField(n)}var i=r.getSelection().clone();n.data("selection",i);n.siblings(".fc-selected").remove();var s=e("<div/>").append(i);return s}});return r};var f=e.extend({},e.fn.fieldChooser.defaults,t);var l=parseInt(this.attr("tabIndex"));if(isNaN(l)){l=0}this.removeAttr("tabIndex");var c=(new a(this,l)).addClass("fc-source-fields");var h=(new a(this,l)).addClass("fc-destination-fields");var p=null;this.getOptions=function(){return f};this.getSourceList=function(){return c};this.getDestinationList=function(){return h};this.getFieldList=function(e){var t=h;if(e.parent().hasClass("fc-source-fields")){t=c}return t};h.on("sortstop",function(e,t){var n=t.item.data("selection");if(i(c,t.item,t.offset)){c.add(n);s.trigger("listChanged",[n,c]);t.item.after(n).remove()}else if(i(h,t.item,t.offset)){t.item.after(n).remove()}else{h.getSelection().remove();c.add(n);o=c;c.clearSelection();p=c;s.trigger("listChanged",[n,c])}});c.on("sortstop",function(e,t){var n=t.item.data("selection");if(i(h,t.item,t.offset)){h.add(n);s.trigger("listChanged",[n,h])}else if(i(c,t.item,t.offset)){}else{c.sortable("cancel")}t.item.after(n).remove()});h.on("selectionChanged",u);c.on("selectionChanged",u);h.on("focusin",function(){p=h});h.on("focusout",function(){if(p==h){p=null}});c.on("focusin",function(){p=c});c.on("focusout",function(){if(p==c){p=null}});e(document).keydown(function(){if(p){if(event.which==38){if(event.shiftKey){p.extendSelection(true)}else{var e=p.getSelectedIndex();var t=e-1;if(t<0){t=0}p.selectAt(t)}}else if(event.which==40){if(event.shiftKey){p.extendSelection(false)}else{var e=p.getSelectedIndex();var t=e+1;if(e<0){t=p.getFields().length-1}p.selectAt(t)}}else if(event.which==27){p.selectAt(-1)}}});return this};e.fn.fieldChooser.defaults={}})(jQuery)